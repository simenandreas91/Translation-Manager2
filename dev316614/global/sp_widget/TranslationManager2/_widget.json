{
    "instance": {
        "name": "dev316614",
        "url": "https://dev316614.service-now.com",
        "g_ck": "84016f43c38172906b68770d050131229ff157793f2430a1fde1b2b7790c79792e23c695"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "Translation Manager2",
    "sys_id": "7238668bc3c532906b68770d0501318b",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Body HTML template",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<div class=\"tm2-widget\">\n  <div class=\"tm2-card tm2-search-card\">\n    <div class=\"tm2-card__header\">\n      <div class=\"tm2-card__heading\">\n        <span class=\"tm2-card__icon fa fa-language\" aria-hidden=\"true\"></span>\n        <div>\n          <h2 class=\"tm2-card__title\">Translation Helper</h2>\n          <p class=\"tm2-card__subtitle\">Search field labels, choice options, UI messages, and portal text by translated copy</p>\n        </div>\n      </div>\n      <div class=\"tm2-card__meta\">\n        <span class=\"tm2-chip tm2-chip--ghost\" ng-if=\"c.state.lastSearchTerm\">\n          <span class=\"fa fa-history\" aria-hidden=\"true\"></span>\n          <span>Last: \"<span ng-bind=\"c.state.lastSearchTerm\"></span>\"</span>\n        </span>\n        <span class=\"tm2-card__badge\" ng-if=\"c.state.results.length\">{{c.state.results.length}} {{c.state.results.length === 1 ? 'match' : 'matches'}}</span>\n      </div>\n    </div>\n\n    <div class=\"tm2-source-toggle\" role=\"group\" aria-label=\"Translation source\">\n      <button\n        type=\"button\"\n        class=\"tm2-source-toggle__btn\"\n        ng-class=\"{'active': c.state.sourceType === 'table'}\"\n        ng-click=\"c.setSourceType('table')\"\n        ng-disabled=\"c.state.isSearching\">\n        <span class=\"fa fa-table\" aria-hidden=\"true\"></span>\n        <span>Fields & choices</span>\n      </button>\n      <button\n        type=\"button\"\n        class=\"tm2-source-toggle__btn\"\n        ng-class=\"{'active': c.state.sourceType === 'message'}\"\n        ng-click=\"c.setSourceType('message')\"\n        ng-disabled=\"c.state.isSearching\">\n        <span class=\"fa fa-commenting-o\" aria-hidden=\"true\"></span>\n        <span>Messages</span>\n      </button>\n      <button\n        type=\"button\"\n        class=\"tm2-source-toggle__btn\"\n        ng-class=\"{'active': c.state.sourceType === 'translated'}\"\n        ng-click=\"c.setSourceType('translated')\"\n        ng-disabled=\"c.state.isSearching\">\n        <span class=\"fa fa-columns\" aria-hidden=\"true\"></span>\n        <span>Portal text</span>\n      </button>\n    </div>\n\n    <form class=\"tm2-search\" ng-submit=\"c.search()\">\n      <div class=\"tm2-field-row\">\n        <div\n          class=\"form-group tm2-table-input\"\n          ng-if=\"c.state.sourceType === 'table'\">\n          <label for=\"tm2-table-input\">Table</label>\n          <input\n            id=\"tm2-table-input\"\n            type=\"text\"\n            class=\"form-control\"\n            placeholder=\"e.g. incident\"\n            ng-model=\"c.state.tableName\"\n            ng-disabled=\"c.state.isSearching\" />\n        </div>\n\n        <div class=\"form-group tm2-search-input\" ng-class=\"{'tm2-search-input--full': c.state.sourceType !== 'table'}\">\n          <label for=\"tm2-search-input\">\n            {{c.state.sourceType === 'message'\n              ? 'Message text (exact match)'\n              : (c.state.sourceType === 'translated'\n                ? 'Portal text (contains match)'\n                : 'Translated text')}}\n          </label>\n          <div class=\"input-group tm2-search__input\">\n            <input\n              id=\"tm2-search-input\"\n              type=\"text\"\n              class=\"form-control\"\n              ng-attr-placeholder=\"{{c.state.sourceType === 'message'\n                ? 'e.g. Systemegenskaper'\n                : (c.state.sourceType === 'translated'\n                  ? 'e.g. Mine favoritter'\n                  : 'e.g. kort beskrivelse')}}\"\n              ng-model=\"c.state.searchTerm\"\n              ng-disabled=\"c.state.isSearching\" />\n            <span class=\"input-group-btn\">\n              <button class=\"btn btn-primary\" type=\"submit\" ng-disabled=\"c.state.isSearching\">\n                <span ng-if=\"c.state.isSearching\" class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></span>\n                <span ng-if=\"!c.state.isSearching\" class=\"fa fa-search\" aria-hidden=\"true\"></span>\n                <span class=\"sr-only\">Search</span>\n              </button>\n            </span>\n          </div>\n          <small class=\"tm2-message-mode-hint\" ng-if=\"c.state.sourceType === 'message'\">\n            <span class=\"fa fa-info-circle\" aria-hidden=\"true\"></span>\n            Enter the exact localized copy you want to edit.\n          </small>\n          <small class=\"tm2-message-mode-hint\" ng-if=\"c.state.sourceType === 'translated'\">\n            <span class=\"fa fa-info-circle\" aria-hidden=\"true\"></span>\n            Search matches portal text that contains your phrase.\n          </small>\n        </div>\n      </div>\n    </form>\n\n    <div class=\"tm2-status tm2-status--error\" role=\"alert\" ng-if=\"c.state.error\">\n      <span class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></span>\n      <span ng-bind=\"c.state.error\"></span>\n    </div>\n    <div class=\"tm2-status tm2-status--info\" role=\"status\" ng-if=\"!c.state.error && c.state.message\">\n      <span class=\"fa fa-info-circle\" aria-hidden=\"true\"></span>\n      <span>\n        <span ng-bind=\"c.state.message\"></span>\n        <span ng-if=\"c.state.lastSearchTerm\"> for \"<span ng-bind=\"c.state.lastSearchTerm\"></span>\"</span>\n      </span>\n    </div>\n  </div>\n\n  <div class=\"tm2-results\" ng-if=\"c.state.results.length\">\n    <div class=\"tm2-card tm2-result-card\" ng-repeat=\"result in c.state.results track by result.sys_id\">\n      <div class=\"tm2-card__header tm2-card__header--result\">\n        <div class=\"tm2-card__heading\">\n          <span\n            class=\"tm2-card__icon tm2-card__icon--result fa\"\n            ng-class=\"{\n              'fa-list-ul': result.recordType === 'choice',\n              'fa-commenting-o': result.recordType === 'message',\n              'fa-columns': result.recordType === 'translated',\n              'fa-tag': !result.recordType || result.recordType === 'field'\n            }\"\n            aria-hidden=\"true\"></span>\n          <div class=\"tm2-entry-title\">\n            <h3 ng-bind=\"result.recordType === 'message'\n              ? (result.message || '(no message)')\n              : (result.recordType === 'translated'\n                ? (result.value || '(no value)')\n                : (result.label || '(no label)'))\"></h3>\n            <small ng-if=\"result.recordType === 'choice'\">\n              <span ng-bind=\"result.element || '(no element)'\"></span>\n              <span> value </span>\n              <span class=\"tm2-choice-value\" ng-bind=\"result.value || 'n/a'\"></span>\n            </small>\n            <small ng-if=\"result.recordType === 'translated'\">\n              <span ng-bind=\"result.tablename || '(no table)'\"></span>\n              <span ng-if=\"result.fieldname\"> · <span ng-bind=\"result.fieldname\"></span></span>\n            </small>\n            <small ng-if=\"(!result.recordType || result.recordType === 'field') && result.element\" ng-bind=\"result.element\"></small>\n          </div>\n        </div>\n        <div class=\"tm2-entry-meta\">\n          <span class=\"tm2-chip tm2-chip--ghost\" title=\"Source\" ng-bind=\"result.recordType === 'choice' ? 'Choice' : (result.recordType === 'message' ? 'Message' : (result.recordType === 'translated' ? 'Portal text' : 'Field label'))\"></span>\n          <span class=\"tm2-chip\" title=\"Table\" ng-if=\"result.recordType !== 'message' && result.name\" ng-bind=\"result.name\"></span>\n          <span class=\"tm2-chip\" title=\"Field\" ng-if=\"result.recordType === 'translated' && result.fieldname\" ng-bind=\"result.fieldname\"></span>\n          <span class=\"tm2-chip\" title=\"Language\" ng-bind=\"result.language || 'n/a'\"></span>\n          <span class=\"tm2-chip\" title=\"Scope\" ng-bind=\"result.scope || 'n/a'\"></span>\n        </div>\n      </div>\n\n      <div class=\"tm2-card__body\" ng-switch=\"result.recordType\">\n        <div ng-switch-when=\"choice\">\n          <div class=\"tm2-section-label\">\n            <strong>Choice translation</strong>\n            <span>Update the localized label shown for this option.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group\">\n              <label>Choice label</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.__draft.label\" ng-disabled=\"result.__saving\" />\n            </div>\n            <div class=\"form-group\">\n              <label>Value</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.value\" readonly />\n            </div>\n            <div class=\"form-group\" ng-if=\"result.dependent_value\">\n              <label>Dependent value</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.dependent_value\" readonly />\n            </div>\n          </div>\n        </div>\n        <div ng-switch-when=\"message\">\n          <div class=\"tm2-section-label\">\n            <strong>Message translation</strong>\n            <span>Edit the localized text for this UI message.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group tm2-field--wide\">\n              <label>Message</label>\n              <textarea class=\"form-control\" rows=\"3\" ng-model=\"result.__draft.message\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n          </div>\n        </div>\n        <div ng-switch-when=\"translated\">\n          <div class=\"tm2-section-label\">\n            <strong>Portal translation</strong>\n            <span>Update the localized value shown on portal menus and widgets.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group tm2-field--wide\">\n              <label>Value</label>\n              <textarea class=\"form-control\" rows=\"3\" ng-model=\"result.__draft.value\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n          </div>\n        </div>\n        <div ng-switch-default>\n          <div class=\"tm2-section-label\">\n            <strong>Translation values</strong>\n            <span>Update the localized copy and preview changes live.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group\">\n              <label>Label</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.__draft.label\" ng-disabled=\"result.__saving\" />\n            </div>\n            <div class=\"form-group\">\n              <label>Plural</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.__draft.plural\" ng-disabled=\"result.__saving\" />\n            </div>\n            <div class=\"form-group\">\n              <label>Hint</label>\n              <textarea class=\"form-control\" rows=\"2\" ng-model=\"result.__draft.hint\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n            <div class=\"form-group\">\n              <label>Help</label>\n              <textarea class=\"form-control\" rows=\"3\" ng-model=\"result.__draft.help\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"tm2-actions\">\n          <button\n            type=\"button\"\n            class=\"btn btn-primary\"\n            ng-click=\"c.saveResult(result)\"\n            ng-disabled=\"!c.hasChanges(result) || result.__saving\">\n            <span ng-if=\"result.__saving\" class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></span>\n            <span ng-if=\"!result.__saving\" class=\"fa fa-save\" aria-hidden=\"true\"></span>\n            <span>Save</span>\n          </button>\n          <button\n            type=\"button\"\n            class=\"btn btn-default\"\n            ng-click=\"c.resetDraft(result)\"\n            ng-disabled=\"result.__saving || !c.hasChanges(result)\">\n            Reset\n          </button>\n        </div>\n\n        <div class=\"tm2-inline-message text-success\" ng-if=\"result.__message\">\n          <span class=\"fa fa-check-circle\" aria-hidden=\"true\"></span>\n          <span ng-bind=\"result.__message\"></span>\n        </div>\n        <div class=\"tm2-inline-message text-danger\" ng-if=\"result.__error\">\n          <span class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></span>\n          <span ng-bind=\"result.__error\"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"tm2-empty\" ng-if=\"!c.state.isSearching && !c.state.results.length && !c.state.error && !c.state.message\">\n    <span class=\"fa fa-compass\"></span>\n    <h4>Find translations faster</h4>\n    <p>Point the helper at a table, type part of the translated text, and we will surface matching labels instantly.</p>\n  </div>\n</div>\n",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<div class=\"tm2-widget\">\n  <div class=\"tm2-card tm2-search-card\">\n    <div class=\"tm2-card__header\">\n      <div class=\"tm2-card__heading\">\n        <span class=\"tm2-card__icon fa fa-language\" aria-hidden=\"true\"></span>\n        <div>\n          <h2 class=\"tm2-card__title\">Translation Helper</h2>\n          <p class=\"tm2-card__subtitle\">Search field labels, choice options, UI messages, and portal text by translated copy</p>\n        </div>\n      </div>\n      <div class=\"tm2-card__meta\">\n        <span class=\"tm2-chip tm2-chip--ghost\" ng-if=\"c.state.lastSearchTerm\">\n          <span class=\"fa fa-history\" aria-hidden=\"true\"></span>\n          <span>Last: \"<span ng-bind=\"c.state.lastSearchTerm\"></span>\"</span>\n        </span>\n        <span class=\"tm2-card__badge\" ng-if=\"c.state.results.length\">{{c.state.results.length}} {{c.state.results.length === 1 ? 'match' : 'matches'}}</span>\n      </div>\n    </div>\n\n    <div class=\"tm2-source-toggle\" role=\"group\" aria-label=\"Translation source\">\n      <button\n        type=\"button\"\n        class=\"tm2-source-toggle__btn\"\n        ng-class=\"{'active': c.state.sourceType === 'table'}\"\n        ng-click=\"c.setSourceType('table')\"\n        ng-disabled=\"c.state.isSearching\">\n        <span class=\"fa fa-table\" aria-hidden=\"true\"></span>\n        <span>Fields & choices</span>\n      </button>\n      <button\n        type=\"button\"\n        class=\"tm2-source-toggle__btn\"\n        ng-class=\"{'active': c.state.sourceType === 'message'}\"\n        ng-click=\"c.setSourceType('message')\"\n        ng-disabled=\"c.state.isSearching\">\n        <span class=\"fa fa-commenting-o\" aria-hidden=\"true\"></span>\n        <span>Messages</span>\n      </button>\n      <button\n        type=\"button\"\n        class=\"tm2-source-toggle__btn\"\n        ng-class=\"{'active': c.state.sourceType === 'translated'}\"\n        ng-click=\"c.setSourceType('translated')\"\n        ng-disabled=\"c.state.isSearching\">\n        <span class=\"fa fa-columns\" aria-hidden=\"true\"></span>\n        <span>Portal text</span>\n      </button>\n    </div>\n\n    <form class=\"tm2-search\" ng-submit=\"c.search()\">\n      <div class=\"tm2-field-row\">\n        <div\n          class=\"form-group tm2-table-input\"\n          ng-if=\"c.state.sourceType === 'table'\">\n          <label for=\"tm2-table-input\">Table</label>\n          <input\n            id=\"tm2-table-input\"\n            type=\"text\"\n            class=\"form-control\"\n            placeholder=\"e.g. incident\"\n            ng-model=\"c.state.tableName\"\n            ng-disabled=\"c.state.isSearching\" />\n        </div>\n\n        <div class=\"form-group tm2-search-input\" ng-class=\"{'tm2-search-input--full': c.state.sourceType !== 'table'}\">\n          <label for=\"tm2-search-input\">\n            {{c.state.sourceType === 'message'\n              ? 'Message text (exact match)'\n              : (c.state.sourceType === 'translated'\n                ? 'Portal text (contains match)'\n                : 'Translated text')}}\n          </label>\n          <div class=\"input-group tm2-search__input\">\n            <input\n              id=\"tm2-search-input\"\n              type=\"text\"\n              class=\"form-control\"\n              ng-attr-placeholder=\"{{c.state.sourceType === 'message'\n                ? 'e.g. Systemegenskaper'\n                : (c.state.sourceType === 'translated'\n                  ? 'e.g. Mine favoritter'\n                  : 'e.g. kort beskrivelse')}}\"\n              ng-model=\"c.state.searchTerm\"\n              ng-disabled=\"c.state.isSearching\" />\n            <span class=\"input-group-btn\">\n              <button class=\"btn btn-primary\" type=\"submit\" ng-disabled=\"c.state.isSearching\">\n                <span ng-if=\"c.state.isSearching\" class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></span>\n                <span ng-if=\"!c.state.isSearching\" class=\"fa fa-search\" aria-hidden=\"true\"></span>\n                <span class=\"sr-only\">Search</span>\n              </button>\n            </span>\n          </div>\n          <small class=\"tm2-message-mode-hint\" ng-if=\"c.state.sourceType === 'message'\">\n            <span class=\"fa fa-info-circle\" aria-hidden=\"true\"></span>\n            Enter the exact localized copy you want to edit.\n          </small>\n          <small class=\"tm2-message-mode-hint\" ng-if=\"c.state.sourceType === 'translated'\">\n            <span class=\"fa fa-info-circle\" aria-hidden=\"true\"></span>\n            Search matches portal text that contains your phrase.\n          </small>\n        </div>\n      </div>\n    </form>\n\n    <div class=\"tm2-status tm2-status--error\" role=\"alert\" ng-if=\"c.state.error\">\n      <span class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></span>\n      <span ng-bind=\"c.state.error\"></span>\n    </div>\n    <div class=\"tm2-status tm2-status--info\" role=\"status\" ng-if=\"!c.state.error && c.state.message\">\n      <span class=\"fa fa-info-circle\" aria-hidden=\"true\"></span>\n      <span>\n        <span ng-bind=\"c.state.message\"></span>\n        <span ng-if=\"c.state.lastSearchTerm\"> for \"<span ng-bind=\"c.state.lastSearchTerm\"></span>\"</span>\n      </span>\n    </div>\n  </div>\n\n  <div class=\"tm2-results\" ng-if=\"c.state.results.length\">\n    <div class=\"tm2-card tm2-result-card\" ng-repeat=\"result in c.state.results track by result.sys_id\">\n      <div class=\"tm2-card__header tm2-card__header--result\">\n        <div class=\"tm2-card__heading\">\n          <span\n            class=\"tm2-card__icon tm2-card__icon--result fa\"\n            ng-class=\"{\n              'fa-list-ul': result.recordType === 'choice',\n              'fa-commenting-o': result.recordType === 'message',\n              'fa-columns': result.recordType === 'translated',\n              'fa-tag': !result.recordType || result.recordType === 'field'\n            }\"\n            aria-hidden=\"true\"></span>\n          <div class=\"tm2-entry-title\">\n            <h3 ng-bind=\"result.recordType === 'message'\n              ? (result.message || '(no message)')\n              : (result.recordType === 'translated'\n                ? (result.value || '(no value)')\n                : (result.label || '(no label)'))\"></h3>\n            <small ng-if=\"result.recordType === 'choice'\">\n              <span ng-bind=\"result.element || '(no element)'\"></span>\n              <span> value </span>\n              <span class=\"tm2-choice-value\" ng-bind=\"result.value || 'n/a'\"></span>\n            </small>\n            <small ng-if=\"result.recordType === 'translated'\">\n              <span ng-bind=\"result.tablename || '(no table)'\"></span>\n              <span ng-if=\"result.fieldname\"> · <span ng-bind=\"result.fieldname\"></span></span>\n            </small>\n            <small ng-if=\"(!result.recordType || result.recordType === 'field') && result.element\" ng-bind=\"result.element\"></small>\n          </div>\n        </div>\n        <div class=\"tm2-entry-meta\">\n          <span class=\"tm2-chip tm2-chip--ghost\" title=\"Source\" ng-bind=\"result.recordType === 'choice' ? 'Choice' : (result.recordType === 'message' ? 'Message' : (result.recordType === 'translated' ? 'Portal text' : 'Field label'))\"></span>\n          <span class=\"tm2-chip\" title=\"Table\" ng-if=\"result.recordType !== 'message' && result.name\" ng-bind=\"result.name\"></span>\n          <span class=\"tm2-chip\" title=\"Field\" ng-if=\"result.recordType === 'translated' && result.fieldname\" ng-bind=\"result.fieldname\"></span>\n          <span class=\"tm2-chip\" title=\"Language\" ng-bind=\"result.language || 'n/a'\"></span>\n          <span class=\"tm2-chip\" title=\"Scope\" ng-bind=\"result.scope || 'n/a'\"></span>\n        </div>\n      </div>\n\n      <div class=\"tm2-card__body\" ng-switch=\"result.recordType\">\n        <div ng-switch-when=\"choice\">\n          <div class=\"tm2-section-label\">\n            <strong>Choice translation</strong>\n            <span>Update the localized label shown for this option.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group\">\n              <label>Choice label</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.__draft.label\" ng-disabled=\"result.__saving\" />\n            </div>\n            <div class=\"form-group\">\n              <label>Value</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.value\" readonly />\n            </div>\n            <div class=\"form-group\" ng-if=\"result.dependent_value\">\n              <label>Dependent value</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.dependent_value\" readonly />\n            </div>\n          </div>\n        </div>\n        <div ng-switch-when=\"message\">\n          <div class=\"tm2-section-label\">\n            <strong>Message translation</strong>\n            <span>Edit the localized text for this UI message.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group tm2-field--wide\">\n              <label>Message</label>\n              <textarea class=\"form-control\" rows=\"3\" ng-model=\"result.__draft.message\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n          </div>\n        </div>\n        <div ng-switch-when=\"translated\">\n          <div class=\"tm2-section-label\">\n            <strong>Portal translation</strong>\n            <span>Update the localized value shown on portal menus and widgets.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group tm2-field--wide\">\n              <label>Value</label>\n              <textarea class=\"form-control\" rows=\"3\" ng-model=\"result.__draft.value\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n          </div>\n        </div>\n        <div ng-switch-default>\n          <div class=\"tm2-section-label\">\n            <strong>Translation values</strong>\n            <span>Update the localized copy and preview changes live.</span>\n          </div>\n          <div class=\"tm2-field-grid\">\n            <div class=\"form-group\">\n              <label>Label</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.__draft.label\" ng-disabled=\"result.__saving\" />\n            </div>\n            <div class=\"form-group\">\n              <label>Plural</label>\n              <input type=\"text\" class=\"form-control\" ng-model=\"result.__draft.plural\" ng-disabled=\"result.__saving\" />\n            </div>\n            <div class=\"form-group\">\n              <label>Hint</label>\n              <textarea class=\"form-control\" rows=\"2\" ng-model=\"result.__draft.hint\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n            <div class=\"form-group\">\n              <label>Help</label>\n              <textarea class=\"form-control\" rows=\"3\" ng-model=\"result.__draft.help\" ng-disabled=\"result.__saving\"></textarea>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"tm2-actions\">\n          <button\n            type=\"button\"\n            class=\"btn btn-primary\"\n            ng-click=\"c.saveResult(result)\"\n            ng-disabled=\"!c.hasChanges(result) || result.__saving\">\n            <span ng-if=\"result.__saving\" class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></span>\n            <span ng-if=\"!result.__saving\" class=\"fa fa-save\" aria-hidden=\"true\"></span>\n            <span>Save</span>\n          </button>\n          <button\n            type=\"button\"\n            class=\"btn btn-default\"\n            ng-click=\"c.resetDraft(result)\"\n            ng-disabled=\"result.__saving || !c.hasChanges(result)\">\n            Reset\n          </button>\n        </div>\n\n        <div class=\"tm2-inline-message text-success\" ng-if=\"result.__message\">\n          <span class=\"fa fa-check-circle\" aria-hidden=\"true\"></span>\n          <span ng-bind=\"result.__message\"></span>\n        </div>\n        <div class=\"tm2-inline-message text-danger\" ng-if=\"result.__error\">\n          <span class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></span>\n          <span ng-bind=\"result.__error\"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"tm2-empty\" ng-if=\"!c.state.isSearching && !c.state.results.length && !c.state.error && !c.state.message\">\n    <span class=\"fa fa-compass\"></span>\n    <h4>Find translations faster</h4>\n    <p>Point the helper at a table, type part of the translated text, and we will surface matching labels instantly.</p>\n  </div>\n</div>\n",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": ".tm2-widget {\r\n  padding: 1.5rem;\r\n  background: linear-gradient(145deg, #f4f6fb 0%, #ffffff 45%, #f1f5ff 100%);\r\n  border-radius: 16px;\r\n  box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.04);\r\n  display: block;\r\n  font-size: 1.5rem;\r\n  line-height: 1.65;\r\n\r\n  label {\r\n    font-weight: 600;\r\n    margin-bottom: 0.25rem;\r\n    display: block;\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .form-control,\r\n  textarea.form-control {\r\n    border-radius: 10px;\r\n    border: 1px solid rgba(148, 163, 184, 0.6);\r\n    background: #fdfdff;\r\n    min-height: 42px;\r\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .form-control:focus,\r\n  textarea.form-control:focus {\r\n    border-color: #2563eb;\r\n    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);\r\n  }\r\n\r\n  textarea.form-control {\r\n    min-height: 72px;\r\n    resize: vertical;\r\n  }\r\n\r\n  .btn {\r\n    border-radius: 999px;\r\n    font-weight: 600;\r\n    border-width: 1px;\r\n    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;\r\n\r\n    &:focus {\r\n      outline: none;\r\n      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);\r\n    }\r\n  }\r\n\r\n  .btn-primary {\r\n    border-color: transparent;\r\n    background: linear-gradient(120deg, #2563eb, #0ea5e9);\r\n    box-shadow: 0 15px 30px rgba(37, 99, 235, 0.35);\r\n\r\n    &:hover:not([disabled]) {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 20px 35px rgba(37, 99, 235, 0.4);\r\n    }\r\n  }\r\n\r\n  .btn-default,\r\n  .btn-secondary {\r\n    border-color: rgba(148, 163, 184, 0.7);\r\n    color: #1f2937;\r\n    background: #fff;\r\n\r\n    &:hover:not([disabled]) {\r\n      background: #f8fafc;\r\n      color: #0f172a;\r\n    }\r\n  }\r\n\r\n  .tm2-card {\r\n    background: #fff;\r\n    border: 1px solid rgba(148, 163, 184, 0.2);\r\n    border-radius: 12px;\r\n    box-shadow: 0 10px 35px rgba(15, 23, 42, 0.08);\r\n    margin-bottom: 1.25rem;\r\n    overflow: hidden;\r\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\r\n\r\n    &:hover {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.12);\r\n    }\r\n  }\r\n\r\n  .tm2-result-card {\r\n    background: linear-gradient(135deg, rgba(255, 247, 237, 0.95), rgba(255, 255, 255, 0.95));\r\n    border-color: rgba(251, 146, 60, 0.35);\r\n  }\r\n\r\n  .tm2-card__header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    gap: 1rem;\r\n    padding: 1rem 2rem;\r\n    border-bottom: 1px solid rgba(226, 232, 240, 0.8);\r\n    align-items: center;\r\n    background: linear-gradient(120deg, rgba(59, 130, 246, 0.08), rgba(14, 165, 233, 0.05));\r\n\r\n    &--result {\r\n      background: linear-gradient(120deg, rgba(249, 115, 22, 0.12), rgba(236, 138, 0, 0.08));\r\n      border-bottom-color: rgba(248, 200, 151, 0.8);\r\n    }\r\n  }\r\n\r\n  .tm2-card__heading {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 0.85rem;\r\n  }\r\n\r\n  .tm2-card__icon {\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 10px;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background: #eff6ff;\r\n    color: #2563eb;\r\n    font-size: 2rem;\r\n\r\n    &--result {\r\n      background: rgba(249, 115, 22, 0.15);\r\n      color: #d97706;\r\n    }\r\n  }\r\n\r\n  .tm2-card__meta {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 0.35rem;\r\n    align-items: flex-end;\r\n  }\r\n\r\n  .tm2-card__body {\r\n    padding: 2rem;\r\n  }\r\n\r\n  .tm2-card__title {\r\n    font-size: 2rem;\r\n    margin: 0;\r\n  }\r\n\r\n  .tm2-card__subtitle {\r\n    margin: 0;\r\n    color: #6b778c;\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .tm2-card__badge {\r\n    background: #2563eb;\r\n    color: #fff;\r\n    font-weight: 600;\r\n    padding: 0.35rem 0.9rem;\r\n    border-radius: 999px;\r\n    text-transform: uppercase;\r\n    font-size: 1.3rem;\r\n    letter-spacing: 0.04em;\r\n    box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);\r\n  }\r\n\r\n  .tm2-search-card {\r\n    padding: 0;\r\n\r\n    .tm2-source-toggle {\r\n      display: inline-flex;\r\n      gap: 0.75rem;\r\n      padding: 1.25rem 1.5rem 0;\r\n      flex-wrap: wrap;\r\n    }\r\n\r\n    .tm2-source-toggle__btn {\r\n      border: 1px solid rgba(148, 163, 184, 0.6);\r\n      background: #fff;\r\n      color: #0f172a;\r\n      border-radius: 30px;\r\n      padding: 0.4rem 1.1rem;\r\n      display: inline-flex;\r\n      align-items: center;\r\n      gap: 0.4rem;\r\n      font-weight: 600;\r\n      text-transform: none;\r\n      transition: all 0.2s ease;\r\n\r\n      &.active {\r\n        background: linear-gradient(120deg, #2563eb, #0ea5e9);\r\n        color: #fff;\r\n        border-color: transparent;\r\n        box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);\r\n      }\r\n\r\n      &:disabled {\r\n        opacity: 0.7;\r\n        cursor: not-allowed;\r\n      }\r\n    }\r\n\r\n    .tm2-search {\r\n      padding: 1.25rem 1.5rem 1.5rem;\r\n\r\n      .tm2-field-row {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 1rem;\r\n      }\r\n\r\n      .form-group {\r\n        margin-bottom: 0;\r\n        flex: 1 1 220px;\r\n      }\r\n\r\n      .tm2-table-input {\r\n        max-width: 320px;\r\n      }\r\n\r\n      .tm2-search-input {\r\n        flex: 2 1 320px;\r\n      }\r\n\r\n      .tm2-search-input--full {\r\n        flex: 1 1 100%;\r\n      }\r\n\r\n      .tm2-message-mode-hint {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 0.4rem;\r\n        margin-top: 0.5rem;\r\n        color: #0f4c81;\r\n        font-weight: 600;\r\n        font-size: 1.3rem;\r\n\r\n        .fa {\r\n          color: #2563eb;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .tm2-search__input .btn {\r\n    min-width: 44px;\r\n    border-top-left-radius: 0;\r\n    border-bottom-left-radius: 0;\r\n    font-weight: 600;\r\n  }\r\n\r\n  .tm2-status {\r\n    display: flex;\r\n    align-items: center;\r\n    margin: 0 1.25rem 1.25rem;\r\n    padding: 0.75rem 1rem;\r\n    border-radius: 4px;\r\n    border: 1px solid transparent;\r\n    font-weight: 600;\r\n    background: #f4f6fb;\r\n    color: #2b3a55;\r\n    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.5), 0 6px 18px rgba(15, 23, 42, 0.05);\r\n    font-size: 1.05rem;\r\n\r\n    &--error {\r\n      background: #fdecea;\r\n      color: #b42318;\r\n      border-color: #f8d7da;\r\n    }\r\n\r\n    &--info {\r\n      border-color: #bcdffb;\r\n      color: #0f4c81;\r\n    }\r\n  }\r\n\r\n  .tm2-status__icon {\r\n    margin-right: 0.5rem;\r\n    font-size: 1.8rem;\r\n  }\r\n\r\n  .tm2-results {\r\n    margin-top: 0.5rem;\r\n  }\r\n\r\n  .tm2-entry-title {\r\n    h3 {\r\n      margin: 0;\r\n      font-size: 1.8rem;\r\n    }\r\n\r\n    small {\r\n      color: #8a92a6;\r\n      text-transform: lowercase;\r\n      font-size: 1.5rem;\r\n    }\r\n  }\r\n\r\n  .tm2-choice-value {\r\n    display: inline-block;\r\n    font-family: Consolas, 'Courier New', monospace;\r\n    background: rgba(37, 99, 235, 0.12);\r\n    color: #1d4ed8;\r\n    padding: 0.05rem 0.5rem;\r\n    border-radius: 6px;\r\n    font-size: 1.4rem;\r\n    text-transform: none;\r\n  }\r\n\r\n  .tm2-message-key {\r\n    display: inline-block;\r\n    font-weight: 700;\r\n    color: #0f172a;\r\n    margin-left: 0.35rem;\r\n  }\r\n\r\n  .tm2-entry-meta {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 0.35rem;\r\n  }\r\n\r\n  .tm2-chip {\r\n    background: #edf2ff;\r\n    border-radius: 999px;\r\n    padding: 0.25rem 0.85rem;\r\n    font-size: 1.2rem;\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.05em;\r\n    color: #0f172a;\r\n    font-weight: 600;\r\n    box-shadow: inset 0 0 0 1px rgba(79, 70, 229, 0.08);\r\n  }\r\n\r\n  .tm2-chip--ghost {\r\n    background: rgba(255, 255, 255, 0.65);\r\n    color: #0f172a;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 0.35rem;\r\n    text-transform: none;\r\n    letter-spacing: 0;\r\n    font-weight: 600;\r\n    box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.08), 0 3px 8px rgba(15, 23, 42, 0.08);\r\n\r\n    .fa {\r\n      font-size: 2rem;\r\n      color: #2563eb;\r\n    }\r\n  }\r\n\r\n  .tm2-field-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\r\n    gap: 1rem;\r\n\r\n    .form-group {\r\n      background: #f8fafc;\r\n      padding: 0.85rem 0.9rem;\r\n      border-radius: 10px;\r\n      border: 1px solid rgba(226, 232, 240, 0.9);\r\n    }\r\n\r\n    .tm2-field--wide {\r\n      grid-column: 1 / -1;\r\n    }\r\n  }\r\n\r\n  .tm2-section-label {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: baseline;\r\n    margin-bottom: 1rem;\r\n    color: #64748b;\r\n\r\n    strong {\r\n      color: #0f172a;\r\n      font-size: 1.5rem;\r\n    }\r\n\r\n    span {\r\n      font-size: 1.2rem;\r\n    }\r\n  }\r\n\r\n  .tm2-actions {\r\n    margin-top: 1rem;\r\n    display: flex;\r\n    gap: 0.75rem;\r\n    flex-wrap: wrap;\r\n\r\n    .btn {\r\n      min-width: 120px;\r\n      font-size: 1.5rem;\r\n    }\r\n  }\r\n\r\n  .tm2-inline-message {\r\n    margin-top: 0.75rem;\r\n    font-weight: 600;\r\n    font-size: 1.5rem;\r\n\r\n    .fa {\r\n      margin-right: 0.35rem;\r\n    }\r\n  }\r\n\r\n  .tm2-empty {\r\n    text-align: center;\r\n    color: #7a869a;\r\n    margin-top: 2rem;\r\n    max-width: 540px;\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n\r\n    .fa {\r\n      font-size: 2.5rem;\r\n      margin-bottom: 0.5rem;\r\n      display: block;\r\n      color: #2563eb;\r\n    }\r\n\r\n    h4 {\r\n      margin-bottom: 0.5rem;\r\n      color: #0f172a;\r\n      font-weight: 700;\r\n      font-size: 2rem;\r\n    }\r\n\r\n    p {\r\n      margin: 0 auto;\r\n      font-size: 1.6rem;\r\n    }\r\n  }\r\n\r\n  @media (max-width: 767px) {\r\n    .tm2-card__header {\r\n      flex-direction: column;\r\n      align-items: flex-start;\r\n    }\r\n\r\n    .tm2-card__meta {\r\n      align-items: flex-start;\r\n    }\r\n\r\n    .tm2-field-row {\r\n      flex-direction: column;\r\n    }\r\n  }\r\n}\r\n",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": ".tm2-widget {\r\n  padding: 1.5rem;\r\n  background: linear-gradient(145deg, #f4f6fb 0%, #ffffff 45%, #f1f5ff 100%);\r\n  border-radius: 16px;\r\n  box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.04);\r\n  display: block;\r\n  font-size: 1.5rem;\r\n  line-height: 1.65;\r\n\r\n  label {\r\n    font-weight: 600;\r\n    margin-bottom: 0.25rem;\r\n    display: block;\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .form-control,\r\n  textarea.form-control {\r\n    border-radius: 10px;\r\n    border: 1px solid rgba(148, 163, 184, 0.6);\r\n    background: #fdfdff;\r\n    min-height: 42px;\r\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .form-control:focus,\r\n  textarea.form-control:focus {\r\n    border-color: #2563eb;\r\n    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);\r\n  }\r\n\r\n  textarea.form-control {\r\n    min-height: 72px;\r\n    resize: vertical;\r\n  }\r\n\r\n  .btn {\r\n    border-radius: 999px;\r\n    font-weight: 600;\r\n    border-width: 1px;\r\n    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;\r\n\r\n    &:focus {\r\n      outline: none;\r\n      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);\r\n    }\r\n  }\r\n\r\n  .btn-primary {\r\n    border-color: transparent;\r\n    background: linear-gradient(120deg, #2563eb, #0ea5e9);\r\n    box-shadow: 0 15px 30px rgba(37, 99, 235, 0.35);\r\n\r\n    &:hover:not([disabled]) {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 20px 35px rgba(37, 99, 235, 0.4);\r\n    }\r\n  }\r\n\r\n  .btn-default,\r\n  .btn-secondary {\r\n    border-color: rgba(148, 163, 184, 0.7);\r\n    color: #1f2937;\r\n    background: #fff;\r\n\r\n    &:hover:not([disabled]) {\r\n      background: #f8fafc;\r\n      color: #0f172a;\r\n    }\r\n  }\r\n\r\n  .tm2-card {\r\n    background: #fff;\r\n    border: 1px solid rgba(148, 163, 184, 0.2);\r\n    border-radius: 12px;\r\n    box-shadow: 0 10px 35px rgba(15, 23, 42, 0.08);\r\n    margin-bottom: 1.25rem;\r\n    overflow: hidden;\r\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\r\n\r\n    &:hover {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.12);\r\n    }\r\n  }\r\n\r\n  .tm2-result-card {\r\n    background: linear-gradient(135deg, rgba(255, 247, 237, 0.95), rgba(255, 255, 255, 0.95));\r\n    border-color: rgba(251, 146, 60, 0.35);\r\n  }\r\n\r\n  .tm2-card__header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    gap: 1rem;\r\n    padding: 1rem 2rem;\r\n    border-bottom: 1px solid rgba(226, 232, 240, 0.8);\r\n    align-items: center;\r\n    background: linear-gradient(120deg, rgba(59, 130, 246, 0.08), rgba(14, 165, 233, 0.05));\r\n\r\n    &--result {\r\n      background: linear-gradient(120deg, rgba(249, 115, 22, 0.12), rgba(236, 138, 0, 0.08));\r\n      border-bottom-color: rgba(248, 200, 151, 0.8);\r\n    }\r\n  }\r\n\r\n  .tm2-card__heading {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 0.85rem;\r\n  }\r\n\r\n  .tm2-card__icon {\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 10px;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background: #eff6ff;\r\n    color: #2563eb;\r\n    font-size: 2rem;\r\n\r\n    &--result {\r\n      background: rgba(249, 115, 22, 0.15);\r\n      color: #d97706;\r\n    }\r\n  }\r\n\r\n  .tm2-card__meta {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 0.35rem;\r\n    align-items: flex-end;\r\n  }\r\n\r\n  .tm2-card__body {\r\n    padding: 2rem;\r\n  }\r\n\r\n  .tm2-card__title {\r\n    font-size: 2rem;\r\n    margin: 0;\r\n  }\r\n\r\n  .tm2-card__subtitle {\r\n    margin: 0;\r\n    color: #6b778c;\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .tm2-card__badge {\r\n    background: #2563eb;\r\n    color: #fff;\r\n    font-weight: 600;\r\n    padding: 0.35rem 0.9rem;\r\n    border-radius: 999px;\r\n    text-transform: uppercase;\r\n    font-size: 1.3rem;\r\n    letter-spacing: 0.04em;\r\n    box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);\r\n  }\r\n\r\n  .tm2-search-card {\r\n    padding: 0;\r\n\r\n    .tm2-source-toggle {\r\n      display: inline-flex;\r\n      gap: 0.75rem;\r\n      padding: 1.25rem 1.5rem 0;\r\n      flex-wrap: wrap;\r\n    }\r\n\r\n    .tm2-source-toggle__btn {\r\n      border: 1px solid rgba(148, 163, 184, 0.6);\r\n      background: #fff;\r\n      color: #0f172a;\r\n      border-radius: 30px;\r\n      padding: 0.4rem 1.1rem;\r\n      display: inline-flex;\r\n      align-items: center;\r\n      gap: 0.4rem;\r\n      font-weight: 600;\r\n      text-transform: none;\r\n      transition: all 0.2s ease;\r\n\r\n      &.active {\r\n        background: linear-gradient(120deg, #2563eb, #0ea5e9);\r\n        color: #fff;\r\n        border-color: transparent;\r\n        box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);\r\n      }\r\n\r\n      &:disabled {\r\n        opacity: 0.7;\r\n        cursor: not-allowed;\r\n      }\r\n    }\r\n\r\n    .tm2-search {\r\n      padding: 1.25rem 1.5rem 1.5rem;\r\n\r\n      .tm2-field-row {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 1rem;\r\n      }\r\n\r\n      .form-group {\r\n        margin-bottom: 0;\r\n        flex: 1 1 220px;\r\n      }\r\n\r\n      .tm2-table-input {\r\n        max-width: 320px;\r\n      }\r\n\r\n      .tm2-search-input {\r\n        flex: 2 1 320px;\r\n      }\r\n\r\n      .tm2-search-input--full {\r\n        flex: 1 1 100%;\r\n      }\r\n\r\n      .tm2-message-mode-hint {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 0.4rem;\r\n        margin-top: 0.5rem;\r\n        color: #0f4c81;\r\n        font-weight: 600;\r\n        font-size: 1.3rem;\r\n\r\n        .fa {\r\n          color: #2563eb;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .tm2-search__input .btn {\r\n    min-width: 44px;\r\n    border-top-left-radius: 0;\r\n    border-bottom-left-radius: 0;\r\n    font-weight: 600;\r\n  }\r\n\r\n  .tm2-status {\r\n    display: flex;\r\n    align-items: center;\r\n    margin: 0 1.25rem 1.25rem;\r\n    padding: 0.75rem 1rem;\r\n    border-radius: 4px;\r\n    border: 1px solid transparent;\r\n    font-weight: 600;\r\n    background: #f4f6fb;\r\n    color: #2b3a55;\r\n    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.5), 0 6px 18px rgba(15, 23, 42, 0.05);\r\n    font-size: 1.05rem;\r\n\r\n    &--error {\r\n      background: #fdecea;\r\n      color: #b42318;\r\n      border-color: #f8d7da;\r\n    }\r\n\r\n    &--info {\r\n      border-color: #bcdffb;\r\n      color: #0f4c81;\r\n    }\r\n  }\r\n\r\n  .tm2-status__icon {\r\n    margin-right: 0.5rem;\r\n    font-size: 1.8rem;\r\n  }\r\n\r\n  .tm2-results {\r\n    margin-top: 0.5rem;\r\n  }\r\n\r\n  .tm2-entry-title {\r\n    h3 {\r\n      margin: 0;\r\n      font-size: 1.8rem;\r\n    }\r\n\r\n    small {\r\n      color: #8a92a6;\r\n      text-transform: lowercase;\r\n      font-size: 1.5rem;\r\n    }\r\n  }\r\n\r\n  .tm2-choice-value {\r\n    display: inline-block;\r\n    font-family: Consolas, 'Courier New', monospace;\r\n    background: rgba(37, 99, 235, 0.12);\r\n    color: #1d4ed8;\r\n    padding: 0.05rem 0.5rem;\r\n    border-radius: 6px;\r\n    font-size: 1.4rem;\r\n    text-transform: none;\r\n  }\r\n\r\n  .tm2-message-key {\r\n    display: inline-block;\r\n    font-weight: 700;\r\n    color: #0f172a;\r\n    margin-left: 0.35rem;\r\n  }\r\n\r\n  .tm2-entry-meta {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 0.35rem;\r\n  }\r\n\r\n  .tm2-chip {\r\n    background: #edf2ff;\r\n    border-radius: 999px;\r\n    padding: 0.25rem 0.85rem;\r\n    font-size: 1.2rem;\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.05em;\r\n    color: #0f172a;\r\n    font-weight: 600;\r\n    box-shadow: inset 0 0 0 1px rgba(79, 70, 229, 0.08);\r\n  }\r\n\r\n  .tm2-chip--ghost {\r\n    background: rgba(255, 255, 255, 0.65);\r\n    color: #0f172a;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 0.35rem;\r\n    text-transform: none;\r\n    letter-spacing: 0;\r\n    font-weight: 600;\r\n    box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.08), 0 3px 8px rgba(15, 23, 42, 0.08);\r\n\r\n    .fa {\r\n      font-size: 2rem;\r\n      color: #2563eb;\r\n    }\r\n  }\r\n\r\n  .tm2-field-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\r\n    gap: 1rem;\r\n\r\n    .form-group {\r\n      background: #f8fafc;\r\n      padding: 0.85rem 0.9rem;\r\n      border-radius: 10px;\r\n      border: 1px solid rgba(226, 232, 240, 0.9);\r\n    }\r\n\r\n    .tm2-field--wide {\r\n      grid-column: 1 / -1;\r\n    }\r\n  }\r\n\r\n  .tm2-section-label {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: baseline;\r\n    margin-bottom: 1rem;\r\n    color: #64748b;\r\n\r\n    strong {\r\n      color: #0f172a;\r\n      font-size: 1.5rem;\r\n    }\r\n\r\n    span {\r\n      font-size: 1.2rem;\r\n    }\r\n  }\r\n\r\n  .tm2-actions {\r\n    margin-top: 1rem;\r\n    display: flex;\r\n    gap: 0.75rem;\r\n    flex-wrap: wrap;\r\n\r\n    .btn {\r\n      min-width: 120px;\r\n      font-size: 1.5rem;\r\n    }\r\n  }\r\n\r\n  .tm2-inline-message {\r\n    margin-top: 0.75rem;\r\n    font-weight: 600;\r\n    font-size: 1.5rem;\r\n\r\n    .fa {\r\n      margin-right: 0.35rem;\r\n    }\r\n  }\r\n\r\n  .tm2-empty {\r\n    text-align: center;\r\n    color: #7a869a;\r\n    margin-top: 2rem;\r\n    max-width: 540px;\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n\r\n    .fa {\r\n      font-size: 2.5rem;\r\n      margin-bottom: 0.5rem;\r\n      display: block;\r\n      color: #2563eb;\r\n    }\r\n\r\n    h4 {\r\n      margin-bottom: 0.5rem;\r\n      color: #0f172a;\r\n      font-weight: 700;\r\n      font-size: 2rem;\r\n    }\r\n\r\n    p {\r\n      margin: 0 auto;\r\n      font-size: 1.6rem;\r\n    }\r\n  }\r\n\r\n  @media (max-width: 767px) {\r\n    .tm2-card__header {\r\n      flex-direction: column;\r\n      align-items: flex-start;\r\n    }\r\n\r\n    .tm2-card__meta {\r\n      align-items: flex-start;\r\n    }\r\n\r\n    .tm2-field-row {\r\n      flex-direction: column;\r\n    }\r\n  }\r\n}\r\n",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Roles",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function link(scope, element, attrs, controller) {\r  \r}",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function link(scope, element, attrs, controller) {\r  \r}",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Description",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "Defines what the widget does",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Demo data",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Option schema",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Server script",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "(function() {\n  data.maxResults = 50;\n  data.results = [];\n  data.searchTerm = '';\n  data.selectedTable = '';\n  data.appliedTables = [];\n  data.errorMessage = '';\n  data.updateResponse = {};\n  data.serverError = '';\n  data.debugMessages = [];\n  data.sourceType = 'table';\n  data.lastInput = input || {};\n\n  try {\n    logInfo('TM2 widget invoked with action: ' + (input && input.action ? input.action : 'none'));\n    logInfo('TM2 raw input: ' + stringifyInput(input));\n    handleAction();\n  } catch (err) {\n    logError('TM2 widget crashed: ' + err);\n    data.serverError = (err && err.message) ? err.message : 'Unexpected server error.';\n  }\n\n})();\n\nfunction handleAction() {\n  if (!input || !input.action) {\n    return;\n  }\n\n  if (input.action === 'search') {\n    var term = sanitizeSearchTerm(input.searchTerm);\n    var tableName = sanitizeTableName(input.tableName);\n    var sourceType = sanitizeSourceType(input.sourceType || data.sourceType);\n    data.searchTerm = term;\n    data.selectedTable = tableName;\n    data.sourceType = sourceType;\n    logInfo('TM2 search term after sanitize: [' + term + ']');\n    logInfo('TM2 table filter: [' + tableName + ']');\n    logInfo('TM2 source type: [' + sourceType + ']');\n\n    if (!term) {\n      data.errorMessage = 'Enter text to search for translations.';\n      return;\n    }\n\n    if (sourceType === 'message') {\n      data.appliedTables = [];\n      var messageRecordsOnly = searchMessages(term, data.maxResults);\n      data.results = messageRecordsOnly;\n      data.errorMessage = '';\n      return;\n    }\n\n    if (sourceType === 'translated') {\n      data.appliedTables = [];\n      var translatedRecords = searchTranslatedText(term, data.maxResults);\n      data.results = translatedRecords;\n      data.errorMessage = '';\n      return;\n    }\n\n    if (!tableName) {\n      data.errorMessage = 'Provide a table to search within.';\n      return;\n    }\n\n    var tablesToQuery = resolveTableHierarchy(tableName);\n    if (!tablesToQuery.length) {\n      data.errorMessage = 'Table \"' + tableName + '\" was not found.';\n      return;\n    }\n\n    data.appliedTables = tablesToQuery;\n    logInfo('TM2 tables considered: ' + tablesToQuery.join(', '));\n\n    var documentationRecords = searchDocumentation(term, tablesToQuery, data.maxResults);\n    var choiceLimit = Math.max(10, Math.floor((data.maxResults || 50) / 2));\n    var choiceRecords = searchChoices(term, tablesToQuery, choiceLimit);\n    data.results = documentationRecords.concat(choiceRecords);\n    data.errorMessage = '';\n  }\n\n  if (input.action === 'update') {\n    var recordType = (input.record && input.record.recordType) || '';\n    if (recordType === 'choice') {\n      data.updateResponse = updateChoice(input.record);\n    } else if (recordType === 'message') {\n      data.updateResponse = updateMessage(input.record);\n    } else if (recordType === 'translated') {\n      data.updateResponse = updateTranslatedText(input.record);\n    } else {\n      data.updateResponse = updateDocumentation(input.record);\n    }\n  }\n}\n\nfunction searchDocumentation(term, tableNames, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_documentation');\n  var encodedQuery = buildSearchQuery(term);\n\n  if (tableNames && tableNames.length) {\n    gr.addQuery('name', 'IN', tableNames.join(','));\n  }\n  gr.addEncodedQuery(encodedQuery);\n  logInfo('TM2 encoded query: ' + encodedQuery);\n  gr.orderBy('name');\n  gr.orderBy('element');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeDocumentationRecord(gr));\n  }\n\n  logInfo('TM2 search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction searchChoices(term, tableNames, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_choice');\n  var encodedQuery = buildChoiceSearchQuery(term);\n\n  if (tableNames && tableNames.length) {\n    gr.addQuery('name', 'IN', tableNames.join(','));\n  }\n  gr.addEncodedQuery(encodedQuery);\n  logInfo('TM2 choice encoded query: ' + encodedQuery);\n  gr.orderBy('name');\n  gr.orderBy('element');\n  gr.orderBy('value');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeChoiceRecord(gr));\n  }\n\n  logInfo('TM2 choice search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction searchMessages(term, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_ui_message');\n\n  gr.addQuery('message', term);\n  gr.orderBy('key');\n  gr.orderBy('language');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeMessageRecord(gr));\n  }\n\n  logInfo('TM2 message search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction searchTranslatedText(term, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_translated_text');\n  var encodedQuery = buildTranslatedSearchQuery(term);\n\n  gr.addEncodedQuery(encodedQuery);\n  gr.orderBy('tablename');\n  gr.orderBy('fieldname');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeTranslatedRecord(gr));\n  }\n\n  logInfo('TM2 translated text search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction updateDocumentation(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_documentation');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['label', 'plural', 'hint', 'help'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeDocumentationRecord(gr);\n  return response;\n}\n\nfunction updateChoice(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_choice');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['label'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeChoiceRecord(gr);\n  return response;\n}\n\nfunction updateMessage(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_ui_message');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['message'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeMessageRecord(gr);\n  return response;\n}\n\nfunction updateTranslatedText(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_translated_text');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['value'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeTranslatedRecord(gr);\n  return response;\n}\n\nfunction serializeDocumentationRecord(gr) {\n  return {\n    recordType: 'field',\n    sourceTable: 'sys_documentation',\n    editableFields: ['label', 'plural', 'hint', 'help'],\n    sys_id: gr.getUniqueValue(),\n    name: gr.getValue('name') || '',\n    element: gr.getValue('element') || '',\n    label: gr.getValue('label') || '',\n    plural: gr.getValue('plural') || '',\n    hint: gr.getValue('hint') || '',\n    help: gr.getValue('help') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr)\n  };\n}\n\nfunction serializeChoiceRecord(gr) {\n  return {\n    recordType: 'choice',\n    sourceTable: 'sys_choice',\n    editableFields: ['label'],\n    sys_id: gr.getUniqueValue(),\n    name: gr.getValue('name') || '',\n    element: gr.getValue('element') || '',\n    label: gr.getValue('label') || '',\n    value: gr.getValue('value') || '',\n    dependent_value: gr.getValue('dependent_value') || '',\n    sequence: gr.getValue('sequence') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr)\n  };\n}\n\nfunction serializeMessageRecord(gr) {\n  return {\n    recordType: 'message',\n    sourceTable: 'sys_ui_message',\n    editableFields: ['message'],\n    sys_id: gr.getUniqueValue(),\n    name: 'sys_ui_message',\n    key: gr.getValue('key') || '',\n    message: gr.getValue('message') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr)\n  };\n}\n\nfunction serializeTranslatedRecord(gr) {\n  return {\n    recordType: 'translated',\n    sourceTable: 'sys_translated_text',\n    editableFields: ['value'],\n    sys_id: gr.getUniqueValue(),\n    tablename: gr.getValue('tablename') || '',\n    fieldname: gr.getValue('fieldname') || '',\n    documentkey: gr.getValue('documentkey') || '',\n    value: gr.getValue('value') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr),\n    name: gr.getValue('tablename') || ''\n  };\n}\n\nfunction resolveScope(gr) {\n  if (!gr.isValidField('sys_scope')) {\n    return '';\n  }\n\n  var displayValue = gr.getDisplayValue('sys_scope');\n\n  try {\n    var ref = gr.sys_scope.getRefRecord();\n    if (ref && ref.isValidRecord && ref.isValidRecord()) {\n      var scopeName = ref.getValue('scope');\n      if (scopeName) {\n        return scopeName;\n      }\n    }\n  } catch (ignored) {\n    /* ignore ref resolution errors */\n  }\n\n  return displayValue || '';\n}\n\nfunction buildSearchQuery(term) {\n  var encodedTerm = term.replace(/\\^/g, '');\n  var clauses = ['label', 'plural', 'hint', 'help'].map(function(field) {\n    return field + 'LIKE' + encodedTerm;\n  });\n  return clauses.join('^OR');\n}\n\nfunction buildChoiceSearchQuery(term) {\n  var encodedTerm = term.replace(/\\^/g, '');\n  return 'labelLIKE' + encodedTerm;\n}\n\nfunction buildTranslatedSearchQuery(term) {\n  var encodedTerm = term.replace(/\\^/g, '');\n  return 'valueLIKE' + encodedTerm;\n}\n\nfunction sanitizeSearchTerm(term) {\n  if (!term) {\n    return '';\n  }\n\n  return String(term)\n    .replace(/\\^/g, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nfunction sanitizeTableName(tableName) {\n  if (!tableName) {\n    return '';\n  }\n\n  return String(tableName)\n    .toLowerCase()\n    .replace(/[^a-z0-9_]/g, '');\n}\n\nfunction sanitizeSourceType(sourceType) {\n  if (!sourceType) {\n    return 'table';\n  }\n  var normalized = String(sourceType).toLowerCase();\n  if (normalized === 'message') {\n    return 'message';\n  }\n  if (normalized === 'translated') {\n    return 'translated';\n  }\n  return 'table';\n}\n\nfunction logInfo(msg) {\n  pushDebug('INFO', msg);\n  gs.info('[TM2] ' + msg, 'TranslationManager2');\n}\n\nfunction logError(msg) {\n  pushDebug('ERROR', msg);\n  gs.error('[TM2] ' + msg, 'TranslationManager2');\n}\n\nfunction pushDebug(level, msg) {\n  if (!data.debugMessages) {\n    data.debugMessages = [];\n  }\n  data.debugMessages.push('[' + level + '] ' + msg);\n}\n\nfunction stringifyInput(value) {\n  try {\n    return JSON.stringify(value);\n  } catch (e) {\n    return '[unserializable input]';\n  }\n}\n\nfunction resolveTableHierarchy(tableName) {\n  var names = [];\n  if (!tableName) {\n    return names;\n  }\n\n  var gr = new GlideRecord('sys_db_object');\n  if (!gr.get('name', tableName)) {\n    logError('TM2 table not found: ' + tableName);\n    return names;\n  }\n\n  names.push(gr.getValue('name'));\n\n  var current = gr;\n  var guard = 0;\n  while (current.super_class && guard < 20) {\n    guard++;\n    var parent = current.super_class.getRefRecord();\n    if (!parent || !parent.isValidRecord()) {\n      break;\n    }\n    var parentName = parent.getValue('name');\n    if (!parentName) {\n      break;\n    }\n    names.push(parentName);\n    current = parent;\n  }\n\n  return names;\n}\n",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "(function() {\n  data.maxResults = 50;\n  data.results = [];\n  data.searchTerm = '';\n  data.selectedTable = '';\n  data.appliedTables = [];\n  data.errorMessage = '';\n  data.updateResponse = {};\n  data.serverError = '';\n  data.debugMessages = [];\n  data.sourceType = 'table';\n  data.lastInput = input || {};\n\n  try {\n    logInfo('TM2 widget invoked with action: ' + (input && input.action ? input.action : 'none'));\n    logInfo('TM2 raw input: ' + stringifyInput(input));\n    handleAction();\n  } catch (err) {\n    logError('TM2 widget crashed: ' + err);\n    data.serverError = (err && err.message) ? err.message : 'Unexpected server error.';\n  }\n\n})();\n\nfunction handleAction() {\n  if (!input || !input.action) {\n    return;\n  }\n\n  if (input.action === 'search') {\n    var term = sanitizeSearchTerm(input.searchTerm);\n    var tableName = sanitizeTableName(input.tableName);\n    var sourceType = sanitizeSourceType(input.sourceType || data.sourceType);\n    data.searchTerm = term;\n    data.selectedTable = tableName;\n    data.sourceType = sourceType;\n    logInfo('TM2 search term after sanitize: [' + term + ']');\n    logInfo('TM2 table filter: [' + tableName + ']');\n    logInfo('TM2 source type: [' + sourceType + ']');\n\n    if (!term) {\n      data.errorMessage = 'Enter text to search for translations.';\n      return;\n    }\n\n    if (sourceType === 'message') {\n      data.appliedTables = [];\n      var messageRecordsOnly = searchMessages(term, data.maxResults);\n      data.results = messageRecordsOnly;\n      data.errorMessage = '';\n      return;\n    }\n\n    if (sourceType === 'translated') {\n      data.appliedTables = [];\n      var translatedRecords = searchTranslatedText(term, data.maxResults);\n      data.results = translatedRecords;\n      data.errorMessage = '';\n      return;\n    }\n\n    if (!tableName) {\n      data.errorMessage = 'Provide a table to search within.';\n      return;\n    }\n\n    var tablesToQuery = resolveTableHierarchy(tableName);\n    if (!tablesToQuery.length) {\n      data.errorMessage = 'Table \"' + tableName + '\" was not found.';\n      return;\n    }\n\n    data.appliedTables = tablesToQuery;\n    logInfo('TM2 tables considered: ' + tablesToQuery.join(', '));\n\n    var documentationRecords = searchDocumentation(term, tablesToQuery, data.maxResults);\n    var choiceLimit = Math.max(10, Math.floor((data.maxResults || 50) / 2));\n    var choiceRecords = searchChoices(term, tablesToQuery, choiceLimit);\n    data.results = documentationRecords.concat(choiceRecords);\n    data.errorMessage = '';\n  }\n\n  if (input.action === 'update') {\n    var recordType = (input.record && input.record.recordType) || '';\n    if (recordType === 'choice') {\n      data.updateResponse = updateChoice(input.record);\n    } else if (recordType === 'message') {\n      data.updateResponse = updateMessage(input.record);\n    } else if (recordType === 'translated') {\n      data.updateResponse = updateTranslatedText(input.record);\n    } else {\n      data.updateResponse = updateDocumentation(input.record);\n    }\n  }\n}\n\nfunction searchDocumentation(term, tableNames, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_documentation');\n  var encodedQuery = buildSearchQuery(term);\n\n  if (tableNames && tableNames.length) {\n    gr.addQuery('name', 'IN', tableNames.join(','));\n  }\n  gr.addEncodedQuery(encodedQuery);\n  logInfo('TM2 encoded query: ' + encodedQuery);\n  gr.orderBy('name');\n  gr.orderBy('element');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeDocumentationRecord(gr));\n  }\n\n  logInfo('TM2 search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction searchChoices(term, tableNames, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_choice');\n  var encodedQuery = buildChoiceSearchQuery(term);\n\n  if (tableNames && tableNames.length) {\n    gr.addQuery('name', 'IN', tableNames.join(','));\n  }\n  gr.addEncodedQuery(encodedQuery);\n  logInfo('TM2 choice encoded query: ' + encodedQuery);\n  gr.orderBy('name');\n  gr.orderBy('element');\n  gr.orderBy('value');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeChoiceRecord(gr));\n  }\n\n  logInfo('TM2 choice search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction searchMessages(term, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_ui_message');\n\n  gr.addQuery('message', term);\n  gr.orderBy('key');\n  gr.orderBy('language');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeMessageRecord(gr));\n  }\n\n  logInfo('TM2 message search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction searchTranslatedText(term, limit) {\n  var records = [];\n  var gr = new GlideRecordSecure('sys_translated_text');\n  var encodedQuery = buildTranslatedSearchQuery(term);\n\n  gr.addEncodedQuery(encodedQuery);\n  gr.orderBy('tablename');\n  gr.orderBy('fieldname');\n  gr.setLimit(limit || 50);\n  gr.query();\n\n  while (gr.next()) {\n    records.push(serializeTranslatedRecord(gr));\n  }\n\n  logInfo('TM2 translated text search returned ' + records.length + ' records.');\n  return records;\n}\n\nfunction updateDocumentation(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_documentation');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['label', 'plural', 'hint', 'help'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeDocumentationRecord(gr);\n  return response;\n}\n\nfunction updateChoice(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_choice');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['label'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeChoiceRecord(gr);\n  return response;\n}\n\nfunction updateMessage(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_ui_message');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['message'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeMessageRecord(gr);\n  return response;\n}\n\nfunction updateTranslatedText(payload) {\n  var response = {\n    success: false,\n    message: 'Unexpected error.'\n  };\n\n  if (!payload || !payload.sys_id) {\n    response.message = 'Missing record identifier.';\n    return response;\n  }\n\n  var gr = new GlideRecord('sys_translated_text');\n  if (!gr.get(payload.sys_id)) {\n    response.message = 'Record not found.';\n    return response;\n  }\n\n  var editableFields = ['value'];\n  var hasChanges = false;\n\n  editableFields.forEach(function(field) {\n    if (payload.hasOwnProperty(field) && payload[field] !== undefined && payload[field] !== null) {\n      gr.setValue(field, payload[field]);\n      hasChanges = true;\n    }\n  });\n\n  if (!hasChanges) {\n    response.message = 'No changes detected.';\n    return response;\n  }\n\n  gr.setWorkflow(false);\n  var updateResult = gr.update();\n\n  if (!updateResult) {\n    response.message = 'Unable to update record.';\n    return response;\n  }\n\n  response.success = true;\n  response.message = 'Translation updated.';\n  response.record = serializeTranslatedRecord(gr);\n  return response;\n}\n\nfunction serializeDocumentationRecord(gr) {\n  return {\n    recordType: 'field',\n    sourceTable: 'sys_documentation',\n    editableFields: ['label', 'plural', 'hint', 'help'],\n    sys_id: gr.getUniqueValue(),\n    name: gr.getValue('name') || '',\n    element: gr.getValue('element') || '',\n    label: gr.getValue('label') || '',\n    plural: gr.getValue('plural') || '',\n    hint: gr.getValue('hint') || '',\n    help: gr.getValue('help') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr)\n  };\n}\n\nfunction serializeChoiceRecord(gr) {\n  return {\n    recordType: 'choice',\n    sourceTable: 'sys_choice',\n    editableFields: ['label'],\n    sys_id: gr.getUniqueValue(),\n    name: gr.getValue('name') || '',\n    element: gr.getValue('element') || '',\n    label: gr.getValue('label') || '',\n    value: gr.getValue('value') || '',\n    dependent_value: gr.getValue('dependent_value') || '',\n    sequence: gr.getValue('sequence') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr)\n  };\n}\n\nfunction serializeMessageRecord(gr) {\n  return {\n    recordType: 'message',\n    sourceTable: 'sys_ui_message',\n    editableFields: ['message'],\n    sys_id: gr.getUniqueValue(),\n    name: 'sys_ui_message',\n    key: gr.getValue('key') || '',\n    message: gr.getValue('message') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr)\n  };\n}\n\nfunction serializeTranslatedRecord(gr) {\n  return {\n    recordType: 'translated',\n    sourceTable: 'sys_translated_text',\n    editableFields: ['value'],\n    sys_id: gr.getUniqueValue(),\n    tablename: gr.getValue('tablename') || '',\n    fieldname: gr.getValue('fieldname') || '',\n    documentkey: gr.getValue('documentkey') || '',\n    value: gr.getValue('value') || '',\n    language: gr.getValue('language') || '',\n    scope: resolveScope(gr),\n    name: gr.getValue('tablename') || ''\n  };\n}\n\nfunction resolveScope(gr) {\n  if (!gr.isValidField('sys_scope')) {\n    return '';\n  }\n\n  var displayValue = gr.getDisplayValue('sys_scope');\n\n  try {\n    var ref = gr.sys_scope.getRefRecord();\n    if (ref && ref.isValidRecord && ref.isValidRecord()) {\n      var scopeName = ref.getValue('scope');\n      if (scopeName) {\n        return scopeName;\n      }\n    }\n  } catch (ignored) {\n    /* ignore ref resolution errors */\n  }\n\n  return displayValue || '';\n}\n\nfunction buildSearchQuery(term) {\n  var encodedTerm = term.replace(/\\^/g, '');\n  var clauses = ['label', 'plural', 'hint', 'help'].map(function(field) {\n    return field + 'LIKE' + encodedTerm;\n  });\n  return clauses.join('^OR');\n}\n\nfunction buildChoiceSearchQuery(term) {\n  var encodedTerm = term.replace(/\\^/g, '');\n  return 'labelLIKE' + encodedTerm;\n}\n\nfunction buildTranslatedSearchQuery(term) {\n  var encodedTerm = term.replace(/\\^/g, '');\n  return 'valueLIKE' + encodedTerm;\n}\n\nfunction sanitizeSearchTerm(term) {\n  if (!term) {\n    return '';\n  }\n\n  return String(term)\n    .replace(/\\^/g, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nfunction sanitizeTableName(tableName) {\n  if (!tableName) {\n    return '';\n  }\n\n  return String(tableName)\n    .toLowerCase()\n    .replace(/[^a-z0-9_]/g, '');\n}\n\nfunction sanitizeSourceType(sourceType) {\n  if (!sourceType) {\n    return 'table';\n  }\n  var normalized = String(sourceType).toLowerCase();\n  if (normalized === 'message') {\n    return 'message';\n  }\n  if (normalized === 'translated') {\n    return 'translated';\n  }\n  return 'table';\n}\n\nfunction logInfo(msg) {\n  pushDebug('INFO', msg);\n  gs.info('[TM2] ' + msg, 'TranslationManager2');\n}\n\nfunction logError(msg) {\n  pushDebug('ERROR', msg);\n  gs.error('[TM2] ' + msg, 'TranslationManager2');\n}\n\nfunction pushDebug(level, msg) {\n  if (!data.debugMessages) {\n    data.debugMessages = [];\n  }\n  data.debugMessages.push('[' + level + '] ' + msg);\n}\n\nfunction stringifyInput(value) {\n  try {\n    return JSON.stringify(value);\n  } catch (e) {\n    return '[unserializable input]';\n  }\n}\n\nfunction resolveTableHierarchy(tableName) {\n  var names = [];\n  if (!tableName) {\n    return names;\n  }\n\n  var gr = new GlideRecord('sys_db_object');\n  if (!gr.get('name', tableName)) {\n    logError('TM2 table not found: ' + tableName);\n    return names;\n  }\n\n  names.push(gr.getValue('name'));\n\n  var current = gr;\n  var guard = 0;\n  while (current.super_class && guard < 20) {\n    guard++;\n    var parent = current.super_class.getRefRecord();\n    if (!parent || !parent.isValidRecord()) {\n      break;\n    }\n    var parentName = parent.getValue('name');\n    if (!parentName) {\n      break;\n    }\n    names.push(parentName);\n    current = parent;\n  }\n\n  return names;\n}\n",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Has preview",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Defines whether preview data is available",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Public",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Widget publicly available to unauthenticated users",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Docs",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": false,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Client controller",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "api.controller = function($scope) {\n  var c = this;\n  c.data = c.data || {};\n  var defaultEditableFields = ['label', 'plural', 'hint', 'help'];\n\n  c.state = {\n    searchTerm: '',\n    tableName: c.data.selectedTable || '',\n    lastSearchTerm: '',\n    isSearching: false,\n    results: [],\n    message: '',\n    error: '',\n    sourceType: c.data.sourceType || 'table'\n  };\n\n  c.search = function() {\n    c.state.error = '';\n    c.state.message = '';\n\n    var term = (c.state.searchTerm || '').trim();\n    var tableName = (c.state.tableName || '').trim();\n    var sourceType = c.state.sourceType || 'table';\n    if (!term) {\n      c.state.error = 'Enter text to search.';\n      c.state.results = [];\n      return;\n    }\n    if (sourceType === 'table' && !tableName) {\n      c.state.error = 'Select a table to search.';\n      c.state.results = [];\n      return;\n    }\n\n    console.log('[TM2] Searching for translations:', term, 'in table', tableName);\n    c.state.isSearching = true;\n    c.server\n      .get({action: 'search', searchTerm: term, tableName: tableName, sourceType: sourceType})\n      .then(function(response) {\n        var payload = (response || {}).data || {};\n        if (payload.serverError) {\n          c.state.error = payload.serverError;\n          c.state.results = [];\n          console.warn('[TM2] Server error:', payload.serverError);\n          return;\n        }\n\n        if (payload.debugMessages && payload.debugMessages.length) {\n          console.log('[TM2] Server debug messages:', payload.debugMessages);\n        }\n\n        c.state.results = mapResults(payload.results || []);\n        console.log('[TM2] Search response:', payload);\n        if (payload.selectedTable) {\n          c.state.tableName = payload.selectedTable;\n        }\n        if (payload.sourceType) {\n          c.state.sourceType = payload.sourceType;\n        }\n\n        if (payload.errorMessage) {\n          c.state.error = payload.errorMessage;\n        } else if (!c.state.results.length) {\n          c.state.message = 'No matches found.';\n        } else {\n          c.state.message = c.state.results.length === 1 ?\n            '1 match found.' :\n            c.state.results.length + ' matches found.';\n        }\n\n        c.state.lastSearchTerm = term;\n      })\n      .catch(function() {\n        c.state.error = 'Unable to search translations right now.';\n      })\n      .finally(function() {\n        c.state.isSearching = false;\n      });\n  };\n\n  c.setSourceType = function(type) {\n    var allowed = ['table', 'message', 'translated'];\n    var normalized = allowed.indexOf(type) > -1 ? type : 'table';\n    if (c.state.sourceType === normalized) {\n      return;\n    }\n    c.state.sourceType = normalized;\n    if (normalized !== 'table') {\n      c.state.tableName = '';\n    }\n  };\n\n  c.hasChanges = function(result) {\n    if (!result || !result.__draft) {\n      return false;\n    }\n\n    var fields = getEditableFields(result);\n    return fields.some(function(field) {\n      return (result.__draft[field] || '') !== (result[field] || '');\n    });\n  };\n\n  c.resetDraft = function(result) {\n    if (!result) {\n      return;\n    }\n\n    result.__draft = buildDraft(result, getEditableFields(result));\n    result.__message = '';\n    result.__error = '';\n  };\n\n  c.saveResult = function(result) {\n    if (!result || !c.hasChanges(result) || result.__saving) {\n      return;\n    }\n\n    result.__saving = true;\n    result.__message = '';\n    result.__error = '';\n\n    var payload = {\n      action: 'update',\n      record: angular.extend(\n        {sys_id: result.sys_id, recordType: result.recordType},\n        result.__draft\n      )\n    };\n\n    console.log('[TM2] Saving translation for', result.sys_id, payload.record);\n    invokeUpdateRequest(payload)\n      .then(function(response) {\n        console.log('[TM2] Raw update response object:', response);\n        var data = response && (response.data || response.result) ? (response.data || response.result) : (response || {});\n        if (data.debugMessages && data.debugMessages.length) {\n          console.log('[TM2] Server debug messages:', data.debugMessages);\n        }\n\n        console.log('[TM2] Save response:', data);\n        if (data.serverError) {\n          result.__error = data.serverError;\n          console.warn('[TM2] Server error:', data.serverError);\n          return;\n        }\n\n        var updateResponse = data.updateResponse || {};\n\n        if (!updateResponse.success) {\n          result.__error = updateResponse.message || 'Unable to save changes.';\n          return;\n        }\n\n        var updatedRecord = updateResponse.record || {};\n\n        var fields = getEditableFields(result);\n        fields.forEach(function(field) {\n          if (updatedRecord.hasOwnProperty(field)) {\n            result[field] = updatedRecord[field] || '';\n          } else {\n            result[field] = result.__draft[field] || '';\n          }\n        });\n\n        if (angular.isArray(updatedRecord.editableFields) && updatedRecord.editableFields.length) {\n          result.editableFields = updatedRecord.editableFields;\n        }\n        if (updatedRecord.recordType) {\n          result.recordType = updatedRecord.recordType;\n        }\n\n        result.__editableFields = getEditableFields(result);\n        result.__draft = buildDraft(result, result.__editableFields);\n        result.__message = 'Changes saved.';\n      })\n      .catch(function() {\n        result.__error = 'Unable to reach the server.';\n      })\n      .finally(function() {\n        result.__saving = false;\n      });\n  };\n\n  function mapResults(records) {\n    return records.map(function(record) {\n      record.__editableFields = getEditableFields(record);\n      record.__draft = buildDraft(record, record.__editableFields);\n      record.__saving = false;\n      record.__message = '';\n      record.__error = '';\n      return record;\n    });\n  }\n\n  function buildDraft(record, editableFields) {\n    var draft = {};\n    var fields = editableFields || getEditableFields(record);\n    fields.forEach(function(field) {\n      draft[field] = (record && record[field]) || '';\n    });\n    return draft;\n  }\n\n  function getEditableFields(record) {\n    if (record && Array.isArray(record.__editableFields) && record.__editableFields.length) {\n      return record.__editableFields;\n    }\n    if (record && Array.isArray(record.editableFields) && record.editableFields.length) {\n      return record.editableFields;\n    }\n    return defaultEditableFields;\n  }\n\n  function invokeUpdateRequest(payload) {\n    payload = payload || {};\n    var previousValues = {};\n\n    Object.keys(payload).forEach(function(key) {\n      previousValues[key] = {\n        exists: Object.prototype.hasOwnProperty.call(c.data, key),\n        value: c.data[key]\n      };\n      c.data[key] = payload[key];\n    });\n\n    return c.server.update()\n      .finally(function() {\n        Object.keys(payload).forEach(function(key) {\n          var previous = previousValues[key];\n          if (previous.exists) {\n            c.data[key] = previous.value;\n          } else {\n            delete c.data[key];\n          }\n        });\n      });\n  }\n\n};\n",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "api.controller = function($scope) {\n  var c = this;\n  c.data = c.data || {};\n  var defaultEditableFields = ['label', 'plural', 'hint', 'help'];\n\n  c.state = {\n    searchTerm: '',\n    tableName: c.data.selectedTable || '',\n    lastSearchTerm: '',\n    isSearching: false,\n    results: [],\n    message: '',\n    error: '',\n    sourceType: c.data.sourceType || 'table'\n  };\n\n  c.search = function() {\n    c.state.error = '';\n    c.state.message = '';\n\n    var term = (c.state.searchTerm || '').trim();\n    var tableName = (c.state.tableName || '').trim();\n    var sourceType = c.state.sourceType || 'table';\n    if (!term) {\n      c.state.error = 'Enter text to search.';\n      c.state.results = [];\n      return;\n    }\n    if (sourceType === 'table' && !tableName) {\n      c.state.error = 'Select a table to search.';\n      c.state.results = [];\n      return;\n    }\n\n    console.log('[TM2] Searching for translations:', term, 'in table', tableName);\n    c.state.isSearching = true;\n    c.server\n      .get({action: 'search', searchTerm: term, tableName: tableName, sourceType: sourceType})\n      .then(function(response) {\n        var payload = (response || {}).data || {};\n        if (payload.serverError) {\n          c.state.error = payload.serverError;\n          c.state.results = [];\n          console.warn('[TM2] Server error:', payload.serverError);\n          return;\n        }\n\n        if (payload.debugMessages && payload.debugMessages.length) {\n          console.log('[TM2] Server debug messages:', payload.debugMessages);\n        }\n\n        c.state.results = mapResults(payload.results || []);\n        console.log('[TM2] Search response:', payload);\n        if (payload.selectedTable) {\n          c.state.tableName = payload.selectedTable;\n        }\n        if (payload.sourceType) {\n          c.state.sourceType = payload.sourceType;\n        }\n\n        if (payload.errorMessage) {\n          c.state.error = payload.errorMessage;\n        } else if (!c.state.results.length) {\n          c.state.message = 'No matches found.';\n        } else {\n          c.state.message = c.state.results.length === 1 ?\n            '1 match found.' :\n            c.state.results.length + ' matches found.';\n        }\n\n        c.state.lastSearchTerm = term;\n      })\n      .catch(function() {\n        c.state.error = 'Unable to search translations right now.';\n      })\n      .finally(function() {\n        c.state.isSearching = false;\n      });\n  };\n\n  c.setSourceType = function(type) {\n    var allowed = ['table', 'message', 'translated'];\n    var normalized = allowed.indexOf(type) > -1 ? type : 'table';\n    if (c.state.sourceType === normalized) {\n      return;\n    }\n    c.state.sourceType = normalized;\n    if (normalized !== 'table') {\n      c.state.tableName = '';\n    }\n  };\n\n  c.hasChanges = function(result) {\n    if (!result || !result.__draft) {\n      return false;\n    }\n\n    var fields = getEditableFields(result);\n    return fields.some(function(field) {\n      return (result.__draft[field] || '') !== (result[field] || '');\n    });\n  };\n\n  c.resetDraft = function(result) {\n    if (!result) {\n      return;\n    }\n\n    result.__draft = buildDraft(result, getEditableFields(result));\n    result.__message = '';\n    result.__error = '';\n  };\n\n  c.saveResult = function(result) {\n    if (!result || !c.hasChanges(result) || result.__saving) {\n      return;\n    }\n\n    result.__saving = true;\n    result.__message = '';\n    result.__error = '';\n\n    var payload = {\n      action: 'update',\n      record: angular.extend(\n        {sys_id: result.sys_id, recordType: result.recordType},\n        result.__draft\n      )\n    };\n\n    console.log('[TM2] Saving translation for', result.sys_id, payload.record);\n    invokeUpdateRequest(payload)\n      .then(function(response) {\n        console.log('[TM2] Raw update response object:', response);\n        var data = response && (response.data || response.result) ? (response.data || response.result) : (response || {});\n        if (data.debugMessages && data.debugMessages.length) {\n          console.log('[TM2] Server debug messages:', data.debugMessages);\n        }\n\n        console.log('[TM2] Save response:', data);\n        if (data.serverError) {\n          result.__error = data.serverError;\n          console.warn('[TM2] Server error:', data.serverError);\n          return;\n        }\n\n        var updateResponse = data.updateResponse || {};\n\n        if (!updateResponse.success) {\n          result.__error = updateResponse.message || 'Unable to save changes.';\n          return;\n        }\n\n        var updatedRecord = updateResponse.record || {};\n\n        var fields = getEditableFields(result);\n        fields.forEach(function(field) {\n          if (updatedRecord.hasOwnProperty(field)) {\n            result[field] = updatedRecord[field] || '';\n          } else {\n            result[field] = result.__draft[field] || '';\n          }\n        });\n\n        if (angular.isArray(updatedRecord.editableFields) && updatedRecord.editableFields.length) {\n          result.editableFields = updatedRecord.editableFields;\n        }\n        if (updatedRecord.recordType) {\n          result.recordType = updatedRecord.recordType;\n        }\n\n        result.__editableFields = getEditableFields(result);\n        result.__draft = buildDraft(result, result.__editableFields);\n        result.__message = 'Changes saved.';\n      })\n      .catch(function() {\n        result.__error = 'Unable to reach the server.';\n      })\n      .finally(function() {\n        result.__saving = false;\n      });\n  };\n\n  function mapResults(records) {\n    return records.map(function(record) {\n      record.__editableFields = getEditableFields(record);\n      record.__draft = buildDraft(record, record.__editableFields);\n      record.__saving = false;\n      record.__message = '';\n      record.__error = '';\n      return record;\n    });\n  }\n\n  function buildDraft(record, editableFields) {\n    var draft = {};\n    var fields = editableFields || getEditableFields(record);\n    fields.forEach(function(field) {\n      draft[field] = (record && record[field]) || '';\n    });\n    return draft;\n  }\n\n  function getEditableFields(record) {\n    if (record && Array.isArray(record.__editableFields) && record.__editableFields.length) {\n      return record.__editableFields;\n    }\n    if (record && Array.isArray(record.editableFields) && record.editableFields.length) {\n      return record.editableFields;\n    }\n    return defaultEditableFields;\n  }\n\n  function invokeUpdateRequest(payload) {\n    payload = payload || {};\n    var previousValues = {};\n\n    Object.keys(payload).forEach(function(key) {\n      previousValues[key] = {\n        exists: Object.prototype.hasOwnProperty.call(c.data, key),\n        value: c.data[key]\n      };\n      c.data[key] = payload[key];\n    });\n\n    return c.server.update()\n      .finally(function() {\n        Object.keys(payload).forEach(function(key) {\n          var previous = previousValues[key];\n          if (previous.exists) {\n            c.data[key] = previous.value;\n          } else {\n            delete c.data[key];\n          }\n        });\n      });\n  }\n\n};\n",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Data table",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Name",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "Translation Manager2",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {},
            "choice": 0,
            "value": "Translation Manager2",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Application",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_scope",
            "reference_type": "table",
            "displayValue": "Global",
            "readonly": true,
            "hint": "Application containing this record",
            "name": "sys_scope",
            "attributes": {
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "global",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "translation_manager2",
            "readonly": false,
            "hint": "Identifier for $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "translation_manager2",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": -1,
            "label": "Fields",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Identifier name for a reference to the controller in the directive's scope",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}